# API Scoring Homework

## Требования
* `Python` `3.13.x`
* `Redis` `7.x`

## Установка

### 1. Склонировать и перейти в репозиторий:
```
git clone https://github.com/dmitryeskov/api_scoring_homework.git
```

### 2. Установите необходимые зависимости :
```
pip install -r requirements.txt
```

## 3. Для работы сервиса необходимо запустить Redis (порт 4000 по умолчанию)


## Проверка и тестирование

### 1. Для запуска инструментов форматирования или тестов через make

* Запуск форматирования
```
make format
```

* Запуск модульных тестов
```
make unit-tests
```

* Запуск функциональных тестов
```
make functional-tests
```

## Запуск сервиса

### Для запуска сервиса
```
python api.py
```

### По умолчанию прослушивается порт `8080`, чтобы выбрать другой порт, используйте параметр `-p` или `--port`:
```
python api.py -p 8000
```

## Использование сервиса

### 1. Сервис, по умолчанию, предоставляет доступ по маршруту `/method`. Формат запроса следующий:
```
{
  "account": "horns&hoofs",         # имя аккаунта (строка, поле опционально, может быть пустым)
  "login": "h&f",                   # логин аккаунта (строка, поле обязательно, может быть пустым)
  "method": "online_score",         # метод (строка, поле обязательно, может быть пустым)
  "token": "...",                   # токен аутентификации (строка, поле обязательно, может быть пустым)
  "arguments": {...}                # аргументы метода (словарь/json-объект, поле обязательно, может быть пустым)
}
```

### 2. Методы

### Сервис обеспечивает работу двух методов:

* `online_score` - выполнение скоринга
* `clients_interests` - получение списка пользовательских интересов по темам

### Аргументы для методов передаются вместе с телом запроса, в поле `argumets`

### 3. Метод `online_score`

```
{
  ...

  "arguments": {
    "phone": "71234567890",       # номер телефона (строка или число, длиной 11, начинается с 7, поле опционально, может быть пустым)
    "email": "example@mail.com",  # адрес электронной почты (строка, в которой есть @, поле опционально, может быть пустым)
    "first_name": "Иван",         # имя (строка, поле опционально, может быть пустым)
    "last_name": "Иванов",        # фамилия (строка, поле опционально, может быть пустым)
    "birthday": "01.01.1990",     # дата рождения (формате DD.MM.YYYY, с которой прошло не больше 70 лет, поле опционально, может быть пустым)
    "gender": 1                   # пол (число 0, 1 или 2, поле опционально, может быть пустым)
  }

  ...
}
```
### Запрос будет выполнен, если присутсвует хоть одна пара `phone-email`, `first_name-last_name`, `gender-birthday` с непустыми значениями

### В случае успешного выполнения возвращает в ответ результат скоринга:
```
{
  "response": {
    "score": 5.0
  },
  "code": 200
}
```

### 4. Метод `clients_interests`

```
{
  ...

  "arguments": {
    "client_ids": [1, 2, 3],      # идентификаторы клиентов (массив чисел, поле обязательно, не пустое)
    "date": "20.07.2017"          # дата (в формате DD.MM.YYYY, поле опционально, может быть пустым)
  }

  ...
}
```

### В случае успешного выполнения возвращает в ответ результат скоринга:
```
{
  "response": {
    "1": ["books", "hi-tech"],
    "2": ["pets", "tv"],
    "3": ["travel", "music"]
  },
  "code": 200
}
```
